# Lychee link checker configuration
# https://lychee.cli.rs/#/usage/config
#
# CI runs against built HTML with --root-dir:
#   hugo && lychee './public/**/*.html' --root-dir "$(pwd)/public"

# Include URL fragments in checks
include_fragments = true

# Resolve directory URLs to index.html for fragment checking (Hugo pretty URLs)
index_files = ["index.html"]

# Don't allow any redirects
max_redirects = 0

# Accept these HTTP status codes
# 100-103: Informational responses
# 200-299: Success responses
# 403: Forbidden (some sites use for rate limiting)
# 429: Too Many Requests
# 500-599: Server errors (temporary issues shouldn't fail CI)
# 999: LinkedIn's custom status code
accept = [
    "100..=103",
    "200..=299",
    "403",
    "429",
    "500..=599",
    "999"
]

# Exclude URL patterns from checking (treated as regular expressions)
exclude = [
    '^http://localhost',                                  # Development server
    '^https://minfraud\.maxmind\.com',                    # MaxMind minFraud service
    '^https://sandbox\.maxmind\.com',                     # MaxMind sandbox environment
    '^https://www\.maxmind\.com/en/accounts/',            # MaxMind account pages (require login)
    'https://www\.maxmind\.com/en/account/login',         # MaxMind login page
    'https://www\.maxmind\.com/wsdl/minfraud-soap-15\.wsdl', # Legacy SOAP WSDL (404)
    '^https://www\.statista\.com/',                       # Paywall/authentication redirects
    '^https://www\.mckinsey\.com',                        # Consistent timeouts
    '^https://www\.linkedin\.com',                        # Unavoidable redirects
    '^https://www\.haproxy\.com/haproxy-integrations',    # Unavoidable redirects

    # Works in browser but fails in lychee
    'https://metacpan\.org/pod/MaxMind::DB::Reader#%24reader-%3Eiterate_search_tree%28-%24data_callback%2C-%24node_callback-%29',
    'https://metacpan\.org/pod/MaxMind::DB::Writer::Tree#DATA-TYPES',
    'https://metacpan\.org/pod/MaxMind::DB::Writer::Tree#Insert-Order-Merging-and-Overwriting',
    '^https://s1\.goeshow\.com',                          # Site refuses connections
]

# Exclude file paths from getting checked (treated as regular expressions)
exclude_path = [
    'node_modules',  # Exclude node_modules directory
]

# Cache results for 1 day to speed up repeated checks
cache = true
max_cache_age = "1d"

# Skip missing input files instead of erroring
skip_missing = true
